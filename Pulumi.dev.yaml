# ============================================================
# Development Stack - Minimal (~$50-80/month)
# ============================================================
# Uses public subnets with public IPs - no NAT Gateway needed
# Suitable for: Local development, testing, CI/CD
# Capacity: ~50-100 concurrent connections
# ============================================================
#
# IMPORTANT: The encryptionsalt below is auto-generated by Pulumi on first run.
# If you see "CHANGE_ME_ON_FIRST_RUN", run `pulumi stack init dev` to generate
# a proper salt, or run `pulumi up` which will auto-generate one.
# Never commit real encryption salts to version control for production stacks.
# ============================================================

encryptionsalt: v1:CHANGE_ME_ON_FIRST_RUN:v1
config:
  aws:region: eu-central-1

  # ==================== General ====================
  realtime-chat-aws:environment: dev
  realtime-chat-aws:domainName: "your-domain.com"
  realtime-chat-aws:hostedZoneId: "YOUR_HOSTED_ZONE_ID"

  # ==================== Auth0 ====================
  realtime-chat-aws:auth0Domain: "your-tenant.auth0.com"
  realtime-chat-aws:auth0Audience: "https://api.your-domain.com"

  # ==================== VPC ====================
  realtime-chat-aws:availabilityZones: '["eu-central-1a", "eu-central-1b"]'
  realtime-chat-aws:natGateways: "0" # No NAT needed - dev uses public subnets

  # ==================== ECS - API Service ====================
  realtime-chat-aws:apiServiceDesiredCount: "1"
  realtime-chat-aws:apiServiceCpu: "256"
  realtime-chat-aws:apiServiceMemory: "512"
  realtime-chat-aws:apiDeregistrationDelaySeconds: "30"
  realtime-chat-aws:apiStopTimeoutSeconds: "30"

  # ==================== ECS - Realtime Service ====================
  realtime-chat-aws:realtimeServiceDesiredCount: "1"
  realtime-chat-aws:realtimeServiceCpu: "256"
  realtime-chat-aws:realtimeServiceMemory: "512"
  realtime-chat-aws:realtimeMaxConnectionsPerTask: "3000"
  realtime-chat-aws:realtimeScaleOnEventLoopLagMs: "100"
  realtime-chat-aws:realtimeScaleOnConnections: "false"
  realtime-chat-aws:realtimeDeregistrationDelaySeconds: "120"
  realtime-chat-aws:realtimeStopTimeoutSeconds: "60"
  realtime-chat-aws:realtimeMinHealthyPercent: "50"
  realtime-chat-aws:realtimeMaxPercent: "200"
  realtime-chat-aws:realtimeStickyDurationSeconds: "3600"

  # ==================== ECS - Workers Service ====================
  realtime-chat-aws:workerServiceDesiredCount: "1"
  realtime-chat-aws:workerServiceCpu: "256"
  realtime-chat-aws:workerServiceMemory: "512"
  realtime-chat-aws:workerScaleOnQueueDepth: "100"
  realtime-chat-aws:workerScaleOnOldestMessageAge: "300"

  # ==================== ECS - Architecture ====================
  realtime-chat-aws:enableGraviton: "false" # x86_64 for dev compatibility

  # ==================== RDS ====================
  realtime-chat-aws:rdsInstanceClass: "db.t3.micro"
  realtime-chat-aws:rdsAllocatedStorage: "20"
  realtime-chat-aws:rdsMultiAz: "false"
  realtime-chat-aws:enableRdsProxy: "false"
  realtime-chat-aws:rdsProxyMaxConnectionsPercent: "80"
  realtime-chat-aws:rdsProxyIdleClientTimeout: "1800"
  realtime-chat-aws:enableRdsReadReplica: "false"
  realtime-chat-aws:rdsReadReplicaInstanceClass: "db.t3.micro" # Not used but required

  # ==================== Redis ====================
  realtime-chat-aws:redisNodeType: "cache.t3.micro"
  realtime-chat-aws:redisNumCacheNodes: "1"
  realtime-chat-aws:enableRedisSplit: "false"
  realtime-chat-aws:redisAdapterNodeType: "cache.t3.micro"
  realtime-chat-aws:redisAdapterReplicas: "0"
  realtime-chat-aws:redisStateNodeType: "cache.t3.micro"
  realtime-chat-aws:redisStateReplicas: "0"

  # ==================== WAF ====================
  realtime-chat-aws:enableWaf: "false"
  realtime-chat-aws:wafApiRateLimitPer5Min: "2000"
  realtime-chat-aws:wafSocketRateLimitPer5Min: "5000"
