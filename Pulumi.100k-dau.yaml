# ============================================================
# 100k DAU Production Stack (~$1,500-1,900/month)
# ============================================================
# Enterprise-scale product with massive user base
# Suitable for: Late-stage startups, large enterprise applications
# Capacity: ~10,000-30,000 concurrent connections, ~100,000 DAU
# ============================================================

encryptionsalt: v1:CHANGE_ME_ON_FIRST_RUN:v1
config:
  aws:region: eu-central-1

  # ==================== General ====================
  realtime-chat-aws:environment: prod
  realtime-chat-aws:domainName: "your-domain.com"
  realtime-chat-aws:hostedZoneId: "YOUR_HOSTED_ZONE_ID"

  # ==================== Auth0 ====================
  realtime-chat-aws:auth0Domain: "your-tenant.auth0.com"
  realtime-chat-aws:auth0Audience: "https://api.your-domain.com"

  # ==================== VPC ====================
  realtime-chat-aws:availabilityZones: '["eu-central-1a", "eu-central-1b", "eu-central-1c"]'
  realtime-chat-aws:natGateways: "3" # One per AZ for maximum HA

  # ==================== ECS - API Service ====================
  realtime-chat-aws:apiServiceDesiredCount: "4"
  realtime-chat-aws:apiServiceCpu: "1024"
  realtime-chat-aws:apiServiceMemory: "2048"
  realtime-chat-aws:apiDeregistrationDelaySeconds: "30"
  realtime-chat-aws:apiStopTimeoutSeconds: "30"

  # ==================== ECS - Realtime Service ====================
  realtime-chat-aws:realtimeServiceDesiredCount: "6"
  realtime-chat-aws:realtimeServiceCpu: "1024"
  realtime-chat-aws:realtimeServiceMemory: "2048"
  realtime-chat-aws:realtimeMaxConnectionsPerTask: "4000"
  realtime-chat-aws:realtimeScaleOnEventLoopLagMs: "80"
  realtime-chat-aws:realtimeScaleOnConnections: "true"
  realtime-chat-aws:realtimeDeregistrationDelaySeconds: "120"
  realtime-chat-aws:realtimeStopTimeoutSeconds: "60"
  realtime-chat-aws:realtimeMinHealthyPercent: "50"
  realtime-chat-aws:realtimeMaxPercent: "200"
  realtime-chat-aws:realtimeStickyDurationSeconds: "3600"

  # ==================== ECS - Workers Service ====================
  realtime-chat-aws:workerServiceDesiredCount: "3"
  realtime-chat-aws:workerServiceCpu: "512"
  realtime-chat-aws:workerServiceMemory: "1024"
  realtime-chat-aws:workerScaleOnQueueDepth: "100"
  realtime-chat-aws:workerScaleOnOldestMessageAge: "300"

  # ==================== ECS - Architecture ====================
  # Graviton (ARM64) provides up to 20% cost savings with better performance
  # Requires ARM64-compatible Docker images (most node: images support multi-arch)
  realtime-chat-aws:enableGraviton: "true"

  # ==================== RDS ====================
  realtime-chat-aws:rdsInstanceClass: "db.r6g.xlarge"
  realtime-chat-aws:rdsAllocatedStorage: "200"
  realtime-chat-aws:rdsMultiAz: "true"
  realtime-chat-aws:enableRdsProxy: "true"
  realtime-chat-aws:rdsProxyMaxConnectionsPercent: "80"
  realtime-chat-aws:rdsProxyIdleClientTimeout: "1800"
  # Read replica for offloading read-heavy queries (message history, user lookups)
  realtime-chat-aws:enableRdsReadReplica: "true"
  realtime-chat-aws:rdsReadReplicaInstanceClass: "db.r6g.large"

  # ==================== Redis ====================
  # m6g.large: 6.38GB RAM, ~$65/mo - Graviton for cost efficiency
  # Split mode: Adapter handles pub/sub fanout, State handles sessions/presence
  # At 30k concurrent connections, memory usage is ~30-50MB - plenty of headroom
  realtime-chat-aws:redisNodeType: "cache.m6g.large"
  realtime-chat-aws:redisNumCacheNodes: "3"
  realtime-chat-aws:enableRedisSplit: "true"
  realtime-chat-aws:redisAdapterNodeType: "cache.m6g.large"
  realtime-chat-aws:redisAdapterReplicas: "2"
  realtime-chat-aws:redisStateNodeType: "cache.m6g.medium"
  realtime-chat-aws:redisStateReplicas: "2"

  # ==================== WAF ====================
  realtime-chat-aws:enableWaf: "true"
  realtime-chat-aws:wafApiRateLimitPer5Min: "20000"
  realtime-chat-aws:wafSocketRateLimitPer5Min: "50000"
